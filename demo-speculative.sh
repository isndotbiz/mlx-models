#!/bin/bash
# Demo Script - Shows what speculative decoding can do
# This is a safe demo that doesn't start a server, just shows the setup

set -e

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘  SPECULATIVE DECODING - COMPLETE SETUP DEMO                â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Colors for output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}What is Speculative Decoding?${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "A technique that speeds up inference by 1.5-3x with NO quality loss!"
echo ""
echo "How it works:"
echo "  1. Fast draft model generates N tokens quickly"
echo "  2. Main model verifies all tokens in parallel"
echo "  3. Accepted tokens are used, rejected ones regenerated"
echo "  4. Result: Much faster, identical quality"
echo ""

echo -e "${BLUE}Performance Comparison${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
printf "%-30s %15s %12s\n" "Configuration" "Tokens/sec" "Speedup"
printf "%-30s %15s %12s\n" "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" "â”€â”€â”€â”€â”€â”€â”€"
printf "%-30s %15s %12s\n" "Without speculative" "25-35" "1.0x"
printf "%-30s %15s %12s\n" "Fast (3 draft tokens)" "40-50" "~1.5x"
printf "%-30s %15s %12s\n" "Balanced (5 draft tokens)" "50-60" "~2.0x"
printf "%-30s %15s %12s\n" "Max (7 draft tokens)" "60-70+" "~2.5x"
echo ""

echo -e "${BLUE}Models Configured${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Main Model:  Josiefied-Qwen2.5-3B-abliterated"
echo "             â”œâ”€ High quality responses"
echo "             â”œâ”€ Uncensored (abliterated)"
echo "             â””â”€ Uses stable Qwen2.5 (no Qwen3 bugs)"
echo ""
echo "Draft Model: Josiefied-Qwen2.5-0.5B-abliterated"
echo "             â”œâ”€ Same family = high acceptance rate"
echo "             â”œâ”€ Very fast for draft generation"
echo "             â””â”€ Abliterated for consistency"
echo ""

echo -e "${BLUE}Available Presets${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1. FAST (3 draft tokens)"
echo "   ./start-speculative.sh fast"
echo "   â””â”€ Best for: Quick responses, interactive chat"
echo ""
echo "2. BALANCED (5 draft tokens) â­ RECOMMENDED"
echo "   ./start-speculative.sh balanced"
echo "   â””â”€ Best for: General use, coding, most tasks"
echo ""
echo "3. MAX (7 draft tokens)"
echo "   ./start-speculative.sh max"
echo "   â””â”€ Best for: Long generations, bulk processing"
echo ""

echo -e "${BLUE}System Prompts Available${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“ presets/prompts/"
echo "   â”œâ”€ anti-refusal.txt  â­ Best uncensored responses"
echo "   â”œâ”€ expert.txt        ğŸ’¡ Expert technical answers"
echo "   â””â”€ empty.txt         ğŸ”§ No system guidance"
echo ""

echo -e "${BLUE}Quick Commands${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Validate setup:      ./validate-setup.sh"
echo "Start server:        ./start-speculative.sh"
echo "Test performance:    ./test-speculative.sh"
echo "Stop server:         ./stop-server.sh"
echo ""

echo -e "${BLUE}OpenCode Integration${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ“ Already configured!"
echo "âœ“ Default: Balanced preset (optimal)"
echo "âœ“ Three variants available"
echo ""
echo "Just start the server and OpenCode will use it automatically."
echo ""

echo -e "${BLUE}What's Included${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ“ 3 optimized preset scripts (fast, balanced, max)"
echo "âœ“ 3 system prompt presets (anti-refusal, expert, empty)"
echo "âœ“ Main launcher with auto port fallback"
echo "âœ“ Performance test script"
echo "âœ“ Server management tools"
echo "âœ“ Setup validation"
echo "âœ“ Complete documentation"
echo "âœ“ OpenCode integration"
echo ""

echo -e "${BLUE}File Structure${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
tree -L 2 -F /Users/jonathanmallinger/models/presets/ 2>/dev/null || {
    echo "presets/"
    echo "â”œâ”€â”€ speculative-fast.sh*"
    echo "â”œâ”€â”€ speculative-balanced.sh*"
    echo "â”œâ”€â”€ speculative-max.sh*"
    echo "â”œâ”€â”€ README.md"
    echo "â””â”€â”€ prompts/"
    echo "    â”œâ”€â”€ anti-refusal.txt"
    echo "    â”œâ”€â”€ expert.txt"
    echo "    â””â”€â”€ empty.txt"
}
echo ""

echo -e "${BLUE}Next Steps${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo -e "${GREEN}1. Validate everything is set up correctly:${NC}"
echo "   ./validate-setup.sh"
echo ""
echo -e "${GREEN}2. Start the server (recommended preset):${NC}"
echo "   ./start-speculative.sh"
echo ""
echo -e "${GREEN}3. In another terminal, test it:${NC}"
echo "   ./test-speculative.sh"
echo ""
echo -e "${GREEN}4. Use with OpenCode or direct API:${NC}"
echo "   # OpenCode - it's already configured!"
echo "   # Direct API - http://localhost:8000/v1"
echo ""
echo -e "${GREEN}5. When done, stop the server:${NC}"
echo "   ./stop-server.sh"
echo ""

echo -e "${BLUE}Documentation${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "QUICK_START_SPECULATIVE.md         - Detailed quick-start guide"
echo "SPECULATIVE_SETUP_COMPLETE.md      - Setup summary"
echo "SPECULATIVE_DECODING_OVERVIEW.md   - Complete overview"
echo "presets/README.md                  - Preset documentation"
echo ""

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘  Ready to go! Run ./start-speculative.sh to begin          â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
